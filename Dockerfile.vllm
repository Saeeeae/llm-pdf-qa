FROM vllm/vllm-openai:latest

# 작업 디렉토리 설정
WORKDIR /app

# 환경변수 설정
ENV HF_HOME=/root/.cache/huggingface
ENV MODEL_NAME=Qwen/Qwen2.5-20B-Instruct

# 모델 다운로드 스크립트
COPY download_model.py /app/download_model.py

# 포트 노출
EXPOSE 8000

# 모델 다운로드 후 vLLM 서버 실행
CMD python /app/download_model.py && \
    python -m vllm.entrypoints.openai.api_server \
    --model ${MODEL_NAME} \
    --host 0.0.0.0 \
    --port 8000 \
    --tensor-parallel-size 1 \
    --gpu-memory-utilization 0.9 \
    --max-model-len 4096 \
    --dtype auto
